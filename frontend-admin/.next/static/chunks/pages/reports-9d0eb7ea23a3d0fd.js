(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53],{8442:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports",function(){return r(5788)}])},6153:function(e,t,r){"use strict";r.d(t,{Z:function(){return m}});var a=r(5893),n=r(7294),o=r(1163),s=r(1664),l=r.n(s),i=r(4052),c=r(7828),d=r(1414),u=r.n(d);function m(e){let{children:t}=e,[r,s]=(0,n.useState)(!0),[d,m]=(0,n.useState)(null),p=(0,o.useRouter)();(0,n.useEffect)(()=>{let{user:e}=(0,c.v0)();e?m(e):p.push("/login")},[p]);let h=[{href:"/dashboard",icon:i.m6D,label:"Tableau de bord",roles:["admin","secretaire","tresorier"]},{href:"/members",icon:i.WY8,label:"Membres",roles:["admin","secretaire","tresorier"]},{href:"/contributions",icon:i.oQC,label:"Cotisations",roles:["admin","secretaire","tresorier"]},{href:"/celebrants",icon:i.jRj,label:"Par C\xe9l\xe9brant",roles:["admin","secretaire","tresorier"]},{href:"/reports",icon:i.NOg,label:"Rapports",roles:["admin","secretaire","tresorier"]}].filter(e=>d&&e.roles.includes(d.role));return d?(0,a.jsxs)("div",{className:u().container,children:[(0,a.jsxs)("aside",{className:"".concat(u().sidebar," ").concat(r?u().sidebarOpen:u().sidebarClosed),children:[(0,a.jsxs)("div",{className:u().sidebarHeader,children:[(0,a.jsx)("h2",{className:u().logo,children:"\uD83C\uDF1F EHK"}),(0,a.jsx)("button",{className:u().toggleBtn,onClick:()=>s(!r),children:r?(0,a.jsx)(i.q5L,{}):(0,a.jsx)(i.cur,{})})]}),(0,a.jsx)("nav",{className:u().nav,children:h.map(e=>{let t=e.icon,n=p.pathname===e.href||p.pathname.startsWith(e.href+"/");return(0,a.jsxs)(l(),{href:e.href,className:"".concat(u().navItem," ").concat(n?u().navItemActive:""),children:[(0,a.jsx)(t,{className:u().navIcon}),r&&(0,a.jsx)("span",{children:e.label})]},e.href)})}),(0,a.jsxs)("div",{className:u().sidebarFooter,children:[(0,a.jsx)("div",{className:u().userInfo,children:r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:u().userName,children:d.email}),(0,a.jsx)("p",{className:u().userRole,children:d.role})]})}),(0,a.jsxs)("button",{className:u().logoutBtn,onClick:()=>{(0,c.DH)(),p.push("/login")},children:[(0,a.jsx)(i.xqh,{}),r&&(0,a.jsx)("span",{children:"D\xe9connexion"})]})]})]}),(0,a.jsx)("main",{className:u().main,children:t})]}):null}},610:function(e,t,r){"use strict";r.d(t,{ax:function(){return l},kv:function(){return n},p7:function(){return o},yb:function(){return s}});let a=r(7066).Z.create({baseURL:"http://localhost:3000/api",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let n={login:(e,t)=>a.post("/auth/login",{email:e,password:t}),getMe:()=>a.get("/auth/me")},o={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.get("/members",{params:e})},getById:e=>a.get("/members/".concat(e)),create:e=>a.post("/members",e),update:(e,t)=>a.put("/members/".concat(e),t),delete:e=>a.delete("/members/".concat(e))},s={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.get("/contributions",{params:e})},getById:e=>a.get("/contributions/".concat(e)),getStats:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.get("/contributions/stats/summary",{params:e})},getStatsByType:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.get("/contributions/stats/by-type",{params:e})},getCelebrants:()=>a.get("/contributions/celebrants"),create:e=>a.post("/contributions",e),update:(e,t)=>a.put("/contributions/".concat(e),t),delete:e=>a.delete("/contributions/".concat(e))},l={monthly:(e,t)=>a.get("/reports/monthly",{params:{date_debut:e,date_fin:t},responseType:"blob"}),member:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.get("/reports/member/".concat(e),{params:t,responseType:"blob"})},event:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.get("/reports/event/".concat(e),{params:t,responseType:"blob"})},members:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.get("/reports/members",{params:e,responseType:"blob"})},contributions:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a.get("/reports/contributions",{params:e,responseType:"blob"})}}},7828:function(e,t,r){"use strict";r.d(t,{$8:function(){return s},DH:function(){return o},QV:function(){return a},v0:function(){return n}});let a=(e,t)=>{localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t))},n=()=>{{let e=localStorage.getItem("token"),t=localStorage.getItem("user");return{token:e,user:t?JSON.parse(t):null}}},o=()=>{localStorage.removeItem("token"),localStorage.removeItem("user")},s=()=>!!localStorage.getItem("token")},5788:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var a=r(5893),n=r(7294),o=r(6153),s=r(610),l=r(307),i=r(6381),c=r(568),d=r(4052),u=r(9424),m=r.n(u);function p(){let[e,t]=(0,n.useState)(!1),[r,u]=(0,n.useState)([]),[p,h]=(0,n.useState)("monthly"),[_,b]=(0,n.useState)({date_debut:(0,l.Z)(function(e){(0,c.Z)(1,arguments);var t=(0,i.Z)(e);return t.setDate(1),t.setHours(0,0,0,0),t}(new Date),"yyyy-MM-dd"),date_fin:(0,l.Z)(function(e){(0,c.Z)(1,arguments);var t=(0,i.Z)(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}(new Date),"yyyy-MM-dd")}),[v,g]=(0,n.useState)(""),[f,x]=(0,n.useState)("mensuelle");(0,n.useEffect)(()=>{j()},[]);let j=async()=>{try{let e=await s.p7.getAll({statut:"actif"});u(e.data)}catch(e){console.error("Error loading members:",e)}},y=async()=>{t(!0);try{let e,r;switch(p){case"monthly":e=await s.ax.monthly(_.date_debut,_.date_fin),r="rapport_mensuel_".concat(_.date_debut,"_").concat(_.date_fin,".pdf");break;case"member":if(!v){alert("Veuillez s\xe9lectionner un membre"),t(!1);return}e=await s.ax.member(v,{date_debut:_.date_debut||void 0,date_fin:_.date_fin||void 0}),r="rapport_membre_".concat(v,".pdf");break;case"event":e=await s.ax.event(f,{date_debut:_.date_debut||void 0,date_fin:_.date_fin||void 0}),r="rapport_".concat(f,".pdf");break;default:return}let a=window.URL.createObjectURL(e.data),n=document.createElement("a");n.href=a,n.download=r,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)}catch(e){console.error("Error downloading report:",e),alert("Erreur lors du t\xe9l\xe9chargement du rapport")}finally{t(!1)}};return(0,a.jsx)(o.Z,{children:(0,a.jsxs)("div",{className:m().container,children:[(0,a.jsx)("div",{className:m().header,children:(0,a.jsx)("h1",{className:m().title,children:"G\xe9n\xe9ration de Rapports"})}),(0,a.jsxs)("div",{className:m().content,children:[(0,a.jsxs)("div",{className:m().card,children:[(0,a.jsx)("h2",{className:m().cardTitle,children:"Type de rapport"}),(0,a.jsxs)("div",{className:m().radioGroup,children:[(0,a.jsxs)("label",{className:m().radioLabel,children:[(0,a.jsx)("input",{type:"radio",value:"monthly",checked:"monthly"===p,onChange:e=>h(e.target.value)}),(0,a.jsxs)("div",{className:m().radioContent,children:[(0,a.jsx)(d.NOg,{className:m().radioIcon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Rapport mensuel"}),(0,a.jsx)("p",{children:"Rapport global des cotisations sur une p\xe9riode"})]})]})]}),(0,a.jsxs)("label",{className:m().radioLabel,children:[(0,a.jsx)("input",{type:"radio",value:"member",checked:"member"===p,onChange:e=>h(e.target.value)}),(0,a.jsxs)("div",{className:m().radioContent,children:[(0,a.jsx)(d.NOg,{className:m().radioIcon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Rapport individuel"}),(0,a.jsx)("p",{children:"Rapport des cotisations d'un membre sp\xe9cifique"})]})]})]}),(0,a.jsxs)("label",{className:m().radioLabel,children:[(0,a.jsx)("input",{type:"radio",value:"event",checked:"event"===p,onChange:e=>h(e.target.value)}),(0,a.jsxs)("div",{className:m().radioContent,children:[(0,a.jsx)(d.NOg,{className:m().radioIcon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Rapport par \xe9v\xe9nement"}),(0,a.jsx)("p",{children:"Rapport des cotisations par type d'\xe9v\xe9nement"})]})]})]})]})]}),(0,a.jsxs)("div",{className:m().card,children:[(0,a.jsx)("h2",{className:m().cardTitle,children:"Param\xe8tres"}),(0,a.jsxs)("div",{className:m().form,children:["member"===p&&(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsx)("label",{htmlFor:"memberId",children:"Membre *"}),(0,a.jsxs)("select",{id:"memberId",value:v,onChange:e=>g(e.target.value),required:"member"===p,children:[(0,a.jsx)("option",{value:"",children:"S\xe9lectionner un membre"}),r.map(e=>(0,a.jsx)("option",{value:e.id,children:e.nom_complet},e.id))]})]}),"event"===p&&(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsx)("label",{htmlFor:"eventType",children:"Type d'\xe9v\xe9nement *"}),(0,a.jsxs)("select",{id:"eventType",value:f,onChange:e=>x(e.target.value),children:[(0,a.jsx)("option",{value:"mensuelle",children:"Mensuelle"}),(0,a.jsx)("option",{value:"bapteme",children:"Bapt\xeame"}),(0,a.jsx)("option",{value:"mariage",children:"Mariage"}),(0,a.jsx)("option",{value:"cas_particulier",children:"Cas particulier"})]})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsxs)("label",{htmlFor:"date_debut",children:[(0,a.jsx)(d.vlc,{})," Date de d\xe9but ","monthly"===p&&"*"]}),(0,a.jsx)("input",{type:"date",id:"date_debut",value:_.date_debut,onChange:e=>b({..._,date_debut:e.target.value}),required:"monthly"===p})]}),(0,a.jsxs)("div",{className:m().formGroup,children:[(0,a.jsxs)("label",{htmlFor:"date_fin",children:[(0,a.jsx)(d.vlc,{})," Date de fin ","monthly"===p&&"*"]}),(0,a.jsx)("input",{type:"date",id:"date_fin",value:_.date_fin,onChange:e=>b({..._,date_fin:e.target.value}),required:"monthly"===p})]})]})]}),(0,a.jsx)("div",{className:m().actions,children:(0,a.jsxs)("button",{className:m().downloadBtn,onClick:y,disabled:e,children:[(0,a.jsx)(d._hL,{}),e?"G\xe9n\xe9ration...":"T\xe9l\xe9charger le rapport PDF"]})})]})]})})}},1414:function(e){e.exports={container:"Layout_container__l2gjk",sidebar:"Layout_sidebar__saart",sidebarOpen:"Layout_sidebarOpen__THWCw",sidebarClosed:"Layout_sidebarClosed__PuE9D",sidebarHeader:"Layout_sidebarHeader__yeRXA",logo:"Layout_logo__Yfd0y",toggleBtn:"Layout_toggleBtn__wFcRT",nav:"Layout_nav__qOLUE",navItem:"Layout_navItem__dRAc_",navItemActive:"Layout_navItemActive__qGqMp",navIcon:"Layout_navIcon__g1cHI",sidebarFooter:"Layout_sidebarFooter__QOc3J",userInfo:"Layout_userInfo__m2y6A",userName:"Layout_userName__Jcd4T",userRole:"Layout_userRole__xkSlq",logoutBtn:"Layout_logoutBtn___va_g",main:"Layout_main__BqQ1G"}},9424:function(e){e.exports={container:"Reports_container__b01cP",header:"Reports_header__kYJFo",title:"Reports_title__5ouVE",content:"Reports_content__9oTeW",card:"Reports_card__VWhqh",cardTitle:"Reports_cardTitle__MObgG",radioGroup:"Reports_radioGroup__SGnOr",radioLabel:"Reports_radioLabel__s5P_p",radioContent:"Reports_radioContent__nYD1o",radioIcon:"Reports_radioIcon__31Zgv",form:"Reports_form__Izn4L",formGroup:"Reports_formGroup__f_cfP",actions:"Reports_actions__wkO6S",downloadBtn:"Reports_downloadBtn__tzS2O"}}},function(e){e.O(0,[152,143,612,307,888,774,179],function(){return e(e.s=8442)}),_N_E=e.O()}]);