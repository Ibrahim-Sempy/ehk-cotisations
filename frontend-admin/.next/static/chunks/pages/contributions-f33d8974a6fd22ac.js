(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[187],{4701:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/contributions",function(){return a(2380)}])},6153:function(e,t,a){"use strict";a.d(t,{Z:function(){return m}});var n=a(5893),r=a(7294),s=a(1163),o=a(1664),l=a.n(o),i=a(4052),c=a(7828),d=a(1414),u=a.n(d);function m(e){let{children:t}=e,[a,o]=(0,r.useState)(!0),[d,m]=(0,r.useState)(null),_=(0,s.useRouter)();(0,r.useEffect)(()=>{let{user:e}=(0,c.v0)();e?m(e):_.push("/login")},[_]);let p=[{href:"/dashboard",icon:i.m6D,label:"Tableau de bord",roles:["admin","secretaire","tresorier"]},{href:"/members",icon:i.WY8,label:"Membres",roles:["admin","secretaire","tresorier"]},{href:"/contributions",icon:i.oQC,label:"Cotisations",roles:["admin","secretaire","tresorier"]},{href:"/celebrants",icon:i.jRj,label:"Par C\xe9l\xe9brant",roles:["admin","secretaire","tresorier"]},{href:"/reports",icon:i.NOg,label:"Rapports",roles:["admin","secretaire","tresorier"]}].filter(e=>d&&e.roles.includes(d.role));return d?(0,n.jsxs)("div",{className:u().container,children:[(0,n.jsxs)("aside",{className:"".concat(u().sidebar," ").concat(a?u().sidebarOpen:u().sidebarClosed),children:[(0,n.jsxs)("div",{className:u().sidebarHeader,children:[(0,n.jsx)("h2",{className:u().logo,children:"\uD83C\uDF1F EHK"}),(0,n.jsx)("button",{className:u().toggleBtn,onClick:()=>o(!a),children:a?(0,n.jsx)(i.q5L,{}):(0,n.jsx)(i.cur,{})})]}),(0,n.jsx)("nav",{className:u().nav,children:p.map(e=>{let t=e.icon,r=_.pathname===e.href||_.pathname.startsWith(e.href+"/");return(0,n.jsxs)(l(),{href:e.href,className:"".concat(u().navItem," ").concat(r?u().navItemActive:""),children:[(0,n.jsx)(t,{className:u().navIcon}),a&&(0,n.jsx)("span",{children:e.label})]},e.href)})}),(0,n.jsxs)("div",{className:u().sidebarFooter,children:[(0,n.jsx)("div",{className:u().userInfo,children:a&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:u().userName,children:d.email}),(0,n.jsx)("p",{className:u().userRole,children:d.role})]})}),(0,n.jsxs)("button",{className:u().logoutBtn,onClick:()=>{(0,c.DH)(),_.push("/login")},children:[(0,n.jsx)(i.xqh,{}),a&&(0,n.jsx)("span",{children:"D\xe9connexion"})]})]})]}),(0,n.jsx)("main",{className:u().main,children:t})]}):null}},610:function(e,t,a){"use strict";a.d(t,{ax:function(){return l},kv:function(){return r},p7:function(){return s},yb:function(){return o}});let n=a(7066).Z.create({baseURL:"http://localhost:3000/api",headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let r={login:(e,t)=>n.post("/auth/login",{email:e,password:t}),getMe:()=>n.get("/auth/me")},s={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.get("/members",{params:e})},getById:e=>n.get("/members/".concat(e)),create:e=>n.post("/members",e),update:(e,t)=>n.put("/members/".concat(e),t),delete:e=>n.delete("/members/".concat(e))},o={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.get("/contributions",{params:e})},getById:e=>n.get("/contributions/".concat(e)),getStats:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.get("/contributions/stats/summary",{params:e})},getStatsByType:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.get("/contributions/stats/by-type",{params:e})},getCelebrants:()=>n.get("/contributions/celebrants"),create:e=>n.post("/contributions",e),update:(e,t)=>n.put("/contributions/".concat(e),t),delete:e=>n.delete("/contributions/".concat(e))},l={monthly:(e,t)=>n.get("/reports/monthly",{params:{date_debut:e,date_fin:t},responseType:"blob"}),member:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.get("/reports/member/".concat(e),{params:t,responseType:"blob"})},event:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.get("/reports/event/".concat(e),{params:t,responseType:"blob"})},members:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.get("/reports/members",{params:e,responseType:"blob"})},contributions:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.get("/reports/contributions",{params:e,responseType:"blob"})}}},7828:function(e,t,a){"use strict";a.d(t,{$8:function(){return o},DH:function(){return s},QV:function(){return n},v0:function(){return r}});let n=(e,t)=>{localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t))},r=()=>{{let e=localStorage.getItem("token"),t=localStorage.getItem("user");return{token:e,user:t?JSON.parse(t):null}}},s=()=>{localStorage.removeItem("token"),localStorage.removeItem("user")},o=()=>!!localStorage.getItem("token")},2380:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var n=a(5893),r=a(7294),s=a(6153),o=a(610),l=a(7828),i=a(4052),c=a(307),d=a(4578),u=a.n(d),m=a(5530),_=a.n(m);function p(e){let{contribution:t,members:a,onClose:s}=e,[l,d]=(0,r.useState)({type:"mensuelle",montant:"",date:(0,c.Z)(new Date,"yyyy-MM-dd"),membre_id:"",statut:"non_paye",observation:"",celebrant:""}),[u,m]=(0,r.useState)(!1),[p,h]=(0,r.useState)("");(0,r.useEffect)(()=>{t&&d({type:t.type||"mensuelle",montant:t.montant||"",date:t.date||(0,c.Z)(new Date,"yyyy-MM-dd"),membre_id:t.membre_id||"",statut:t.statut||"non_paye",observation:t.observation||"",celebrant:t.celebrant||""})},[t]);let b=e=>{let t="number"===e.target.type?parseFloat(e.target.value):e.target.value;d({...l,[e.target.name]:t})},x=async e=>{e.preventDefault(),h(""),m(!0);try{let e={...l,membre_id:parseInt(l.membre_id),montant:parseFloat(l.montant)};t?await o.yb.update(t.id,e):await o.yb.create(e),s()}catch(e){var a,n;h((null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.error)||"Erreur lors de la sauvegarde")}finally{m(!1)}};return(0,n.jsx)("div",{className:_().overlay,onClick:s,children:(0,n.jsxs)("div",{className:_().modal,onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:_().header,children:[(0,n.jsx)("h2",{children:t?"Modifier la cotisation":"Nouvelle cotisation"}),(0,n.jsx)("button",{className:_().closeBtn,onClick:s,children:(0,n.jsx)(i.q5L,{})})]}),(0,n.jsxs)("form",{onSubmit:x,className:_().form,children:[p&&(0,n.jsx)("div",{className:_().error,children:p}),(0,n.jsxs)("div",{className:_().formGroup,children:[(0,n.jsx)("label",{htmlFor:"membre_id",children:"Membre *"}),(0,n.jsxs)("select",{id:"membre_id",name:"membre_id",value:l.membre_id,onChange:b,required:!0,children:[(0,n.jsx)("option",{value:"",children:"S\xe9lectionner un membre"}),a.map(e=>(0,n.jsx)("option",{value:e.id,children:e.nom_complet},e.id))]})]}),(0,n.jsxs)("div",{className:_().formGroup,children:[(0,n.jsx)("label",{htmlFor:"type",children:"Type *"}),(0,n.jsxs)("select",{id:"type",name:"type",value:l.type,onChange:b,required:!0,children:[(0,n.jsx)("option",{value:"mensuelle",children:"Mensuelle"}),(0,n.jsx)("option",{value:"bapteme",children:"Bapt\xeame"}),(0,n.jsx)("option",{value:"mariage",children:"Mariage"}),(0,n.jsx)("option",{value:"cas_particulier",children:"Cas particulier"})]})]}),(0,n.jsxs)("div",{className:_().formGroup,children:[(0,n.jsx)("label",{htmlFor:"montant",children:"Montant (GNF) *"}),(0,n.jsx)("input",{type:"number",id:"montant",name:"montant",value:l.montant,onChange:b,required:!0,min:"0",step:"0.01"})]}),(0,n.jsxs)("div",{className:_().formGroup,children:[(0,n.jsx)("label",{htmlFor:"date",children:"Date *"}),(0,n.jsx)("input",{type:"date",id:"date",name:"date",value:l.date,onChange:b,required:!0})]}),(0,n.jsxs)("div",{className:_().formGroup,children:[(0,n.jsx)("label",{htmlFor:"statut",children:"Statut *"}),(0,n.jsxs)("select",{id:"statut",name:"statut",value:l.statut,onChange:b,required:!0,children:[(0,n.jsx)("option",{value:"non_paye",children:"Non pay\xe9"}),(0,n.jsx)("option",{value:"paye",children:"Pay\xe9"}),(0,n.jsx)("option",{value:"partiel",children:"Partiel"})]})]}),(0,n.jsxs)("div",{className:_().formGroup,children:[(0,n.jsxs)("label",{htmlFor:"celebrant",children:["C\xe9l\xe9brant ",("bapteme"===l.type||"mariage"===l.type)&&"*"]}),(0,n.jsx)("input",{type:"text",id:"celebrant",name:"celebrant",value:l.celebrant,onChange:b,required:"bapteme"===l.type||"mariage"===l.type,placeholder:"bapteme"===l.type||"mariage"===l.type?"Nom du pr\xeatre ou c\xe9l\xe9brant *":"Nom du pr\xeatre ou c\xe9l\xe9brant (optionnel)",disabled:"mensuelle"===l.type||"cas_particulier"===l.type})]}),(0,n.jsxs)("div",{className:_().formGroup,children:[(0,n.jsx)("label",{htmlFor:"observation",children:"Observation"}),(0,n.jsx)("textarea",{id:"observation",name:"observation",value:l.observation,onChange:b,rows:"3",className:_().textarea})]}),(0,n.jsxs)("div",{className:_().actions,children:[(0,n.jsx)("button",{type:"button",className:_().cancelBtn,onClick:s,children:"Annuler"}),(0,n.jsx)("button",{type:"submit",className:_().submitBtn,disabled:u,children:u?"Enregistrement...":t?"Modifier":"Cr\xe9er"})]})]})]})})}function h(){let[e,t]=(0,r.useState)([]),[a,d]=(0,r.useState)([]),[m,_]=(0,r.useState)(!0),[h,b]=(0,r.useState)(""),[x,v]=(0,r.useState)({type:"all",statut:"all",date_debut:"",date_fin:""}),[y,j]=(0,r.useState)(!1),[g,f]=(0,r.useState)(null),{user:N}=(0,l.v0)();(0,r.useEffect)(()=>{C(),B()},[x,h]);let C=async()=>{try{let e=await o.p7.getAll({statut:"actif"});d(e.data)}catch(e){console.error("Error loading members:",e)}},B=async()=>{try{_(!0);let e={};"all"!==x.type&&(e.type=x.type),"all"!==x.statut&&(e.statut=x.statut),x.date_debut&&(e.date_debut=x.date_debut),x.date_fin&&(e.date_fin=x.date_fin);let a=(await o.yb.getAll(e)).data;h&&(a=a.filter(e=>{var t,a;return(null===(t=e.membre_nom)||void 0===t?void 0:t.toLowerCase().includes(h.toLowerCase()))||(null===(a=e.membre_telephone)||void 0===a?void 0:a.includes(h))})),t(a)}catch(e){console.error("Error loading contributions:",e)}finally{_(!1)}},I=e=>{f(e),j(!0)},S=async e=>{if(confirm("\xcates-vous s\xfbr de vouloir supprimer cette cotisation ?"))try{await o.yb.delete(e),B()}catch(e){console.error("Error deleting contribution:",e),alert("Erreur lors de la suppression")}},w=async()=>{try{let e={};"all"!==x.type&&(e.type=x.type),"all"!==x.statut&&(e.statut=x.statut),x.date_debut&&(e.date_debut=x.date_debut),x.date_fin&&(e.date_fin=x.date_fin);let t=await o.ax.contributions(e),a=window.URL.createObjectURL(new Blob([t.data])),n=document.createElement("a");n.href=a,n.setAttribute("download","liste_cotisations_".concat(Date.now(),".pdf")),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a)}catch(e){console.error("Error downloading PDF:",e),alert("Erreur lors du t\xe9l\xe9chargement du PDF")}},M=e=>({mensuelle:"Mensuelle",bapteme:"Bapt\xeame",mariage:"Mariage",cas_particulier:"Cas particulier"})[e]||e,P=e=>({paye:"Pay\xe9",non_paye:"Non pay\xe9",partiel:"Partiel"})[e]||e,L=(null==N?void 0:N.role)==="admin"||(null==N?void 0:N.role)==="secretaire";return(0,n.jsx)(s.Z,{children:(0,n.jsxs)("div",{className:u().container,children:[(0,n.jsxs)("div",{className:u().header,children:[(0,n.jsx)("h1",{className:u().title,children:"Gestion des Cotisations"}),(0,n.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[(0,n.jsxs)("button",{className:u().downloadBtn,onClick:w,children:[(0,n.jsx)(i._hL,{})," T\xe9l\xe9charger PDF"]}),L&&(0,n.jsxs)("button",{className:u().addBtn,onClick:()=>{f(null),j(!0)},children:[(0,n.jsx)(i.OvN,{})," Ajouter une cotisation"]})]})]}),(0,n.jsxs)("div",{className:u().filters,children:[(0,n.jsxs)("div",{className:u().searchBox,children:[(0,n.jsx)(i.jRj,{className:u().searchIcon}),(0,n.jsx)("input",{type:"text",placeholder:"Rechercher par membre...",value:h,onChange:e=>b(e.target.value),className:u().searchInput})]}),(0,n.jsxs)("select",{value:x.type,onChange:e=>v({...x,type:e.target.value}),className:u().filterSelect,children:[(0,n.jsx)("option",{value:"all",children:"Tous les types"}),(0,n.jsx)("option",{value:"mensuelle",children:"Mensuelle"}),(0,n.jsx)("option",{value:"bapteme",children:"Bapt\xeame"}),(0,n.jsx)("option",{value:"mariage",children:"Mariage"}),(0,n.jsx)("option",{value:"cas_particulier",children:"Cas particulier"})]}),(0,n.jsxs)("select",{value:x.statut,onChange:e=>v({...x,statut:e.target.value}),className:u().filterSelect,children:[(0,n.jsx)("option",{value:"all",children:"Tous les statuts"}),(0,n.jsx)("option",{value:"paye",children:"Pay\xe9"}),(0,n.jsx)("option",{value:"non_paye",children:"Non pay\xe9"}),(0,n.jsx)("option",{value:"partiel",children:"Partiel"})]}),(0,n.jsx)("input",{type:"date",value:x.date_debut,onChange:e=>v({...x,date_debut:e.target.value}),className:u().dateInput,placeholder:"Date d\xe9but"}),(0,n.jsx)("input",{type:"date",value:x.date_fin,onChange:e=>v({...x,date_fin:e.target.value}),className:u().dateInput,placeholder:"Date fin"})]}),m?(0,n.jsx)("div",{className:u().loading,children:"Chargement..."}):0===e.length?(0,n.jsxs)("div",{className:u().empty,children:[(0,n.jsx)(i.Ihx,{size:48}),(0,n.jsx)("p",{children:"Aucune cotisation trouv\xe9e"})]}):(0,n.jsx)("div",{className:u().tableContainer,children:(0,n.jsxs)("table",{className:u().table,children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Date"}),(0,n.jsx)("th",{children:"Membre"}),(0,n.jsx)("th",{children:"Type"}),(0,n.jsx)("th",{children:"Montant"}),(0,n.jsx)("th",{children:"Statut"}),(0,n.jsx)("th",{children:"C\xe9l\xe9brant"}),(0,n.jsx)("th",{children:"Observation"}),L&&(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:e.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,c.Z)(new Date(e.date),"dd/MM/yyyy")}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:u().memberName,children:e.membre_nom}),e.membre_telephone&&(0,n.jsx)("div",{className:u().memberPhone,children:e.membre_telephone})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:u().typeBadge,children:M(e.type)})}),(0,n.jsxs)("td",{className:u().amount,children:[e.montant.toLocaleString()," GNF"]}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:"".concat(u().status," ").concat("paye"===e.statut?u().statusPaye:"partiel"===e.statut?u().statusPartiel:u().statusNonPaye),children:P(e.statut)})}),(0,n.jsx)("td",{children:("bapteme"===e.type||"mariage"===e.type)&&e.celebrant||"-"}),(0,n.jsx)("td",{className:u().observation,children:e.observation||"-"}),L&&(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:u().actions,children:[(0,n.jsx)("button",{className:u().editBtn,onClick:()=>I(e),title:"Modifier",children:(0,n.jsx)(i.vPQ,{})}),(0,n.jsx)("button",{className:u().deleteBtn,onClick:()=>S(e.id),title:"Supprimer",children:(0,n.jsx)(i.Ybf,{})})]})})]},e.id))})]})}),y&&(0,n.jsx)(p,{contribution:g,members:a,onClose:()=>{j(!1),f(null),B()}})]})})}},4578:function(e){e.exports={container:"Contributions_container__d4MUJ",header:"Contributions_header__JJEJU",title:"Contributions_title__dFI34",addBtn:"Contributions_addBtn___VHBc",downloadBtn:"Contributions_downloadBtn__78_D_",filters:"Contributions_filters__nucSS",searchBox:"Contributions_searchBox__2Fm_K",searchIcon:"Contributions_searchIcon__hwczy",searchInput:"Contributions_searchInput__IUgCV",filterSelect:"Contributions_filterSelect__eXd37",dateInput:"Contributions_dateInput__fEtQx",loading:"Contributions_loading__YhgwW",empty:"Contributions_empty__JziBm",tableContainer:"Contributions_tableContainer__oJAeU",table:"Contributions_table__p2NPu",memberName:"Contributions_memberName__dyNK9",memberPhone:"Contributions_memberPhone__VXH3q",typeBadge:"Contributions_typeBadge__eXRTP",amount:"Contributions_amount__29alk",status:"Contributions_status__KIQsK",statusPaye:"Contributions_statusPaye__MVgF5",statusNonPaye:"Contributions_statusNonPaye__kz6D_",statusPartiel:"Contributions_statusPartiel__AvxKC",observation:"Contributions_observation__4_aQh",actions:"Contributions_actions__JjKtA",editBtn:"Contributions_editBtn__WE5Qe",deleteBtn:"Contributions_deleteBtn___qNcM"}},1414:function(e){e.exports={container:"Layout_container__l2gjk",sidebar:"Layout_sidebar__saart",sidebarOpen:"Layout_sidebarOpen__THWCw",sidebarClosed:"Layout_sidebarClosed__PuE9D",sidebarHeader:"Layout_sidebarHeader__yeRXA",logo:"Layout_logo__Yfd0y",toggleBtn:"Layout_toggleBtn__wFcRT",nav:"Layout_nav__qOLUE",navItem:"Layout_navItem__dRAc_",navItemActive:"Layout_navItemActive__qGqMp",navIcon:"Layout_navIcon__g1cHI",sidebarFooter:"Layout_sidebarFooter__QOc3J",userInfo:"Layout_userInfo__m2y6A",userName:"Layout_userName__Jcd4T",userRole:"Layout_userRole__xkSlq",logoutBtn:"Layout_logoutBtn___va_g",main:"Layout_main__BqQ1G"}},5530:function(e){e.exports={overlay:"Modal_overlay__54hP_",modal:"Modal_modal__FRyxj",header:"Modal_header__2jTSN",closeBtn:"Modal_closeBtn__uNGH6",form:"Modal_form__F9tuk",error:"Modal_error__Pi7FA",formGroup:"Modal_formGroup__ELTyT",textarea:"Modal_textarea__escCm",actions:"Modal_actions__w8PtR",cancelBtn:"Modal_cancelBtn__yGftp",submitBtn:"Modal_submitBtn__4uV89"}}},function(e){e.O(0,[152,143,612,307,888,774,179],function(){return e(e.s=4701)}),_N_E=e.O()}]);