(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[483],{9416:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/members",function(){return n(3962)}])},6153:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var r=n(5893),a=n(7294),s=n(1163),o=n(1664),l=n.n(o),i=n(4052),c=n(7828),d=n(1414),u=n.n(d);function m(e){let{children:t}=e,[n,o]=(0,a.useState)(!0),[d,m]=(0,a.useState)(null),h=(0,s.useRouter)();(0,a.useEffect)(()=>{let{user:e}=(0,c.v0)();e?m(e):h.push("/login")},[h]);let _=[{href:"/dashboard",icon:i.m6D,label:"Tableau de bord",roles:["admin","secretaire","tresorier"]},{href:"/members",icon:i.WY8,label:"Membres",roles:["admin","secretaire","tresorier"]},{href:"/contributions",icon:i.oQC,label:"Cotisations",roles:["admin","secretaire","tresorier"]},{href:"/celebrants",icon:i.jRj,label:"Par C\xe9l\xe9brant",roles:["admin","secretaire","tresorier"]},{href:"/reports",icon:i.NOg,label:"Rapports",roles:["admin","secretaire","tresorier"]}].filter(e=>d&&e.roles.includes(d.role));return d?(0,r.jsxs)("div",{className:u().container,children:[(0,r.jsxs)("aside",{className:"".concat(u().sidebar," ").concat(n?u().sidebarOpen:u().sidebarClosed),children:[(0,r.jsxs)("div",{className:u().sidebarHeader,children:[(0,r.jsx)("h2",{className:u().logo,children:"\uD83C\uDF1F EHK"}),(0,r.jsx)("button",{className:u().toggleBtn,onClick:()=>o(!n),children:n?(0,r.jsx)(i.q5L,{}):(0,r.jsx)(i.cur,{})})]}),(0,r.jsx)("nav",{className:u().nav,children:_.map(e=>{let t=e.icon,a=h.pathname===e.href||h.pathname.startsWith(e.href+"/");return(0,r.jsxs)(l(),{href:e.href,className:"".concat(u().navItem," ").concat(a?u().navItemActive:""),children:[(0,r.jsx)(t,{className:u().navIcon}),n&&(0,r.jsx)("span",{children:e.label})]},e.href)})}),(0,r.jsxs)("div",{className:u().sidebarFooter,children:[(0,r.jsx)("div",{className:u().userInfo,children:n&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:u().userName,children:d.email}),(0,r.jsx)("p",{className:u().userRole,children:d.role})]})}),(0,r.jsxs)("button",{className:u().logoutBtn,onClick:()=>{(0,c.DH)(),h.push("/login")},children:[(0,r.jsx)(i.xqh,{}),n&&(0,r.jsx)("span",{children:"D\xe9connexion"})]})]})]}),(0,r.jsx)("main",{className:u().main,children:t})]}):null}},610:function(e,t,n){"use strict";n.d(t,{ax:function(){return l},kv:function(){return a},p7:function(){return s},yb:function(){return o}});let r=n(7066).Z.create({baseURL:"http://localhost:3000/api",headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let a={login:(e,t)=>r.post("/auth/login",{email:e,password:t}),getMe:()=>r.get("/auth/me")},s={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.get("/members",{params:e})},getById:e=>r.get("/members/".concat(e)),create:e=>r.post("/members",e),update:(e,t)=>r.put("/members/".concat(e),t),delete:e=>r.delete("/members/".concat(e))},o={getAll:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.get("/contributions",{params:e})},getById:e=>r.get("/contributions/".concat(e)),getStats:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.get("/contributions/stats/summary",{params:e})},getStatsByType:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.get("/contributions/stats/by-type",{params:e})},getCelebrants:()=>r.get("/contributions/celebrants"),create:e=>r.post("/contributions",e),update:(e,t)=>r.put("/contributions/".concat(e),t),delete:e=>r.delete("/contributions/".concat(e))},l={monthly:(e,t)=>r.get("/reports/monthly",{params:{date_debut:e,date_fin:t},responseType:"blob"}),member:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.get("/reports/member/".concat(e),{params:t,responseType:"blob"})},event:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.get("/reports/event/".concat(e),{params:t,responseType:"blob"})},members:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.get("/reports/members",{params:e,responseType:"blob"})},contributions:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.get("/reports/contributions",{params:e,responseType:"blob"})}}},7828:function(e,t,n){"use strict";n.d(t,{$8:function(){return o},DH:function(){return s},QV:function(){return r},v0:function(){return a}});let r=(e,t)=>{localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t))},a=()=>{{let e=localStorage.getItem("token"),t=localStorage.getItem("user");return{token:e,user:t?JSON.parse(t):null}}},s=()=>{localStorage.removeItem("token"),localStorage.removeItem("user")},o=()=>!!localStorage.getItem("token")},3962:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var r=n(5893),a=n(7294),s=n(6153),o=n(610),l=n(7828),i=n(4052),c=n(307),d=n(568),u=n(3024),m={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},h=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,_=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,p=/^([+-])(\d{2})(?::?(\d{2}))?$/;function b(e){return e?parseInt(e):1}function f(e){return e&&parseFloat(e.replace(",","."))||0}var v=[31,null,31,30,31,30,31,31,30,31,30,31];function g(e){return e%400==0||e%4==0&&e%100!=0}var x=n(911),j=n.n(x),N=n(5530),y=n.n(N);function C(e){let{member:t,onClose:n}=e,[s,l]=(0,a.useState)({nom_complet:"",telephone:"",fonction:"",date_adhesion:"",statut:"actif"}),[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)("");(0,a.useEffect)(()=>{t&&l({nom_complet:t.nom_complet||"",telephone:t.telephone||"",fonction:t.fonction||"",date_adhesion:t.date_adhesion||"",statut:t.statut||"actif"})},[t]);let h=e=>{l({...s,[e.target.name]:e.target.value})},_=async e=>{e.preventDefault(),m(""),d(!0);try{t?await o.p7.update(t.id,s):await o.p7.create(s),n()}catch(e){var r,a;m((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.error)||"Erreur lors de la sauvegarde")}finally{d(!1)}};return(0,r.jsx)("div",{className:y().overlay,onClick:n,children:(0,r.jsxs)("div",{className:y().modal,onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:y().header,children:[(0,r.jsx)("h2",{children:t?"Modifier le membre":"Nouveau membre"}),(0,r.jsx)("button",{className:y().closeBtn,onClick:n,children:(0,r.jsx)(i.q5L,{})})]}),(0,r.jsxs)("form",{onSubmit:_,className:y().form,children:[u&&(0,r.jsx)("div",{className:y().error,children:u}),(0,r.jsxs)("div",{className:y().formGroup,children:[(0,r.jsx)("label",{htmlFor:"nom_complet",children:"Nom complet *"}),(0,r.jsx)("input",{type:"text",id:"nom_complet",name:"nom_complet",value:s.nom_complet,onChange:h,required:!0})]}),(0,r.jsxs)("div",{className:y().formGroup,children:[(0,r.jsx)("label",{htmlFor:"telephone",children:"T\xe9l\xe9phone"}),(0,r.jsx)("input",{type:"tel",id:"telephone",name:"telephone",value:s.telephone,onChange:h})]}),(0,r.jsxs)("div",{className:y().formGroup,children:[(0,r.jsx)("label",{htmlFor:"fonction",children:"Fonction"}),(0,r.jsx)("input",{type:"text",id:"fonction",name:"fonction",value:s.fonction,onChange:h})]}),(0,r.jsxs)("div",{className:y().formGroup,children:[(0,r.jsx)("label",{htmlFor:"date_adhesion",children:"Date d'adh\xe9sion"}),(0,r.jsx)("input",{type:"date",id:"date_adhesion",name:"date_adhesion",value:s.date_adhesion,onChange:h})]}),(0,r.jsxs)("div",{className:y().formGroup,children:[(0,r.jsx)("label",{htmlFor:"statut",children:"Statut"}),(0,r.jsxs)("select",{id:"statut",name:"statut",value:s.statut,onChange:h,children:[(0,r.jsx)("option",{value:"actif",children:"Actif"}),(0,r.jsx)("option",{value:"inactif",children:"Inactif"})]})]}),(0,r.jsxs)("div",{className:y().actions,children:[(0,r.jsx)("button",{type:"button",className:y().cancelBtn,onClick:n,children:"Annuler"}),(0,r.jsx)("button",{type:"submit",className:y().submitBtn,disabled:c,children:c?"Enregistrement...":t?"Modifier":"Cr\xe9er"})]})]})]})})}function I(){let[e,t]=(0,a.useState)([]),[n,x]=(0,a.useState)(!0),[N,y]=(0,a.useState)(""),[I,M]=(0,a.useState)("all"),[w,D]=(0,a.useState)(!1),[S,B]=(0,a.useState)(null),{user:T}=(0,l.v0)();(0,a.useEffect)(()=>{L()},[N,I]);let L=async()=>{try{x(!0);let e={};N&&(e.search=N),"all"!==I&&(e.statut=I);let n=await o.p7.getAll(e);t(n.data)}catch(e){console.error("Error loading members:",e)}finally{x(!1)}},k=e=>{B(e),D(!0)},F=async e=>{if(confirm("\xcates-vous s\xfbr de vouloir d\xe9sactiver ce membre ?"))try{await o.p7.delete(e),L()}catch(e){console.error("Error deleting member:",e),alert("Erreur lors de la suppression")}},A=async()=>{try{let e={};"all"!==I&&(e.statut=I);let t=await o.ax.members(e),n=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=n,r.setAttribute("download","liste_membres_".concat(Date.now(),".pdf")),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n)}catch(e){console.error("Error downloading PDF:",e),alert("Erreur lors du t\xe9l\xe9chargement du PDF")}},E=(null==T?void 0:T.role)==="admin"||(null==T?void 0:T.role)==="secretaire";return(0,r.jsx)(s.Z,{children:(0,r.jsxs)("div",{className:j().container,children:[(0,r.jsxs)("div",{className:j().header,children:[(0,r.jsx)("h1",{className:j().title,children:"Gestion des Membres"}),(0,r.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[(0,r.jsxs)("button",{className:j().downloadBtn,onClick:A,children:[(0,r.jsx)(i._hL,{})," T\xe9l\xe9charger PDF"]}),E&&(0,r.jsxs)("button",{className:j().addBtn,onClick:()=>{B(null),D(!0)},children:[(0,r.jsx)(i.OvN,{})," Ajouter un membre"]})]})]}),(0,r.jsxs)("div",{className:j().filters,children:[(0,r.jsxs)("div",{className:j().searchBox,children:[(0,r.jsx)(i.jRj,{className:j().searchIcon}),(0,r.jsx)("input",{type:"text",placeholder:"Rechercher un membre...",value:N,onChange:e=>y(e.target.value),className:j().searchInput})]}),(0,r.jsxs)("select",{value:I,onChange:e=>M(e.target.value),className:j().filterSelect,children:[(0,r.jsx)("option",{value:"all",children:"Tous"}),(0,r.jsx)("option",{value:"actif",children:"Actifs"}),(0,r.jsx)("option",{value:"inactif",children:"Inactifs"})]})]}),n?(0,r.jsx)("div",{className:j().loading,children:"Chargement..."}):0===e.length?(0,r.jsxs)("div",{className:j().empty,children:[(0,r.jsx)(i.fzv,{size:48}),(0,r.jsx)("p",{children:"Aucun membre trouv\xe9"})]}):(0,r.jsx)("div",{className:j().tableContainer,children:(0,r.jsxs)("table",{className:j().table,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Nom complet"}),(0,r.jsx)("th",{children:"T\xe9l\xe9phone"}),(0,r.jsx)("th",{children:"Fonction"}),(0,r.jsx)("th",{children:"Date d'adh\xe9sion"}),(0,r.jsx)("th",{children:"Statut"}),E&&(0,r.jsx)("th",{children:"Actions"})]})}),(0,r.jsx)("tbody",{children:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.nom_complet}),(0,r.jsx)("td",{children:e.telephone||"-"}),(0,r.jsx)("td",{children:e.fonction||"-"}),(0,r.jsx)("td",{children:e.date_adhesion?(0,c.Z)(function(e,t){(0,d.Z)(1,arguments);var n,r,a,s=(0,u.Z)(null!==(n=null==t?void 0:t.additionalDigits)&&void 0!==n?n:2);if(2!==s&&1!==s&&0!==s)throw RangeError("additionalDigits must be 0, 1 or 2");if(!("string"==typeof e||"[object String]"===Object.prototype.toString.call(e)))return new Date(NaN);var o=function(e){var t,n={},r=e.split(m.dateTimeDelimiter);if(r.length>2)return n;if(/:/.test(r[0])?t=r[0]:(n.date=r[0],t=r[1],m.timeZoneDelimiter.test(n.date)&&(n.date=e.split(m.timeZoneDelimiter)[0],t=e.substr(n.date.length,e.length))),t){var a=m.timezone.exec(t);a?(n.time=t.replace(a[1],""),n.timezone=a[1]):n.time=t}return n}(e);if(o.date){var l=function(e,t){var n=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),r=e.match(n);if(!r)return{year:NaN,restDateString:""};var a=r[1]?parseInt(r[1]):null,s=r[2]?parseInt(r[2]):null;return{year:null===s?a:100*s,restDateString:e.slice((r[1]||r[2]).length)}}(o.date,s);r=function(e,t){if(null===t)return new Date(NaN);var n,r,a=e.match(h);if(!a)return new Date(NaN);var s=!!a[4],o=b(a[1]),l=b(a[2])-1,i=b(a[3]),c=b(a[4]),d=b(a[5])-1;if(s)return c>=1&&c<=53&&d>=0&&d<=6?((n=new Date(0)).setUTCFullYear(t,0,4),r=n.getUTCDay()||7,n.setUTCDate(n.getUTCDate()+((c-1)*7+d+1-r)),n):new Date(NaN);var u=new Date(0);return l>=0&&l<=11&&i>=1&&i<=(v[l]||(g(t)?29:28))&&o>=1&&o<=(g(t)?366:365)?(u.setUTCFullYear(t,l,Math.max(o,i)),u):new Date(NaN)}(l.restDateString,l.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);var i=r.getTime(),c=0;if(o.time&&isNaN(c=function(e){var t=e.match(_);if(!t)return NaN;var n=f(t[1]),r=f(t[2]),a=f(t[3]);return(24===n?0===r&&0===a:a>=0&&a<60&&r>=0&&r<60&&n>=0&&n<25)?36e5*n+6e4*r+1e3*a:NaN}(o.time)))return new Date(NaN);if(o.timezone){if(isNaN(a=function(e){if("Z"===e)return 0;var t=e.match(p);if(!t)return 0;var n="+"===t[1]?-1:1,r=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;return a>=0&&a<=59?n*(36e5*r+6e4*a):NaN}(o.timezone)))return new Date(NaN)}else{var x=new Date(i+c),j=new Date(0);return j.setFullYear(x.getUTCFullYear(),x.getUTCMonth(),x.getUTCDate()),j.setHours(x.getUTCHours(),x.getUTCMinutes(),x.getUTCSeconds(),x.getUTCMilliseconds()),j}return new Date(i+c+a)}(e.date_adhesion),"dd/MM/yyyy"):"-"}),(0,r.jsx)("td",{children:(0,r.jsx)("span",{className:"".concat(j().status," ").concat("actif"===e.statut?j().statusActive:j().statusInactive),children:"actif"===e.statut?"Actif":"Inactif"})}),E&&(0,r.jsx)("td",{children:(0,r.jsxs)("div",{className:j().actions,children:[(0,r.jsx)("button",{className:j().editBtn,onClick:()=>k(e),title:"Modifier",children:(0,r.jsx)(i.vPQ,{})}),(0,r.jsx)("button",{className:j().deleteBtn,onClick:()=>F(e.id),title:"D\xe9sactiver",children:(0,r.jsx)(i.Ybf,{})})]})})]},e.id))})]})}),w&&(0,r.jsx)(C,{member:S,onClose:()=>{D(!1),B(null),L()}})]})})}},1414:function(e){e.exports={container:"Layout_container__l2gjk",sidebar:"Layout_sidebar__saart",sidebarOpen:"Layout_sidebarOpen__THWCw",sidebarClosed:"Layout_sidebarClosed__PuE9D",sidebarHeader:"Layout_sidebarHeader__yeRXA",logo:"Layout_logo__Yfd0y",toggleBtn:"Layout_toggleBtn__wFcRT",nav:"Layout_nav__qOLUE",navItem:"Layout_navItem__dRAc_",navItemActive:"Layout_navItemActive__qGqMp",navIcon:"Layout_navIcon__g1cHI",sidebarFooter:"Layout_sidebarFooter__QOc3J",userInfo:"Layout_userInfo__m2y6A",userName:"Layout_userName__Jcd4T",userRole:"Layout_userRole__xkSlq",logoutBtn:"Layout_logoutBtn___va_g",main:"Layout_main__BqQ1G"}},911:function(e){e.exports={container:"Members_container__192cI",header:"Members_header__puYvb",title:"Members_title__vWNGN",addBtn:"Members_addBtn__B5sg4",downloadBtn:"Members_downloadBtn__x_G9s",filters:"Members_filters__3rzlV",searchBox:"Members_searchBox__I6yg_",searchIcon:"Members_searchIcon__mA384",searchInput:"Members_searchInput__xnJNF",filterSelect:"Members_filterSelect__HLHsG",loading:"Members_loading__f2vwn",empty:"Members_empty___BQxY",tableContainer:"Members_tableContainer__1uiIK",table:"Members_table__kc4aj",status:"Members_status__FjOBd",statusActive:"Members_statusActive__qZ1CA",statusInactive:"Members_statusInactive__uY2Sq",actions:"Members_actions__Vy62l",editBtn:"Members_editBtn__ca7Xc",deleteBtn:"Members_deleteBtn__b95E8"}},5530:function(e){e.exports={overlay:"Modal_overlay__54hP_",modal:"Modal_modal__FRyxj",header:"Modal_header__2jTSN",closeBtn:"Modal_closeBtn__uNGH6",form:"Modal_form__F9tuk",error:"Modal_error__Pi7FA",formGroup:"Modal_formGroup__ELTyT",textarea:"Modal_textarea__escCm",actions:"Modal_actions__w8PtR",cancelBtn:"Modal_cancelBtn__yGftp",submitBtn:"Modal_submitBtn__4uV89"}}},function(e){e.O(0,[152,143,612,307,888,774,179],function(){return e(e.s=9416)}),_N_E=e.O()}]);